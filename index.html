<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MediaToolsHub — All-in-One Image, Video & PDF Toolkit</title>
  <meta name="description" content="MediaToolsHub: compress, resize, convert, crop images; compress videos; and process PDFs — fully client-side, private, and ad-ready." />
  <meta name="keywords" content="image compressor, video compressor, pdf tools, image resize, image convert, cropper, pdf merge, pdf split" />
  <meta name="robots" content="index, follow" />

  <!-- Tailwind CDN for UI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- External libs for PDFs -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>

  <style>
    /* Custom styles for enhanced UI */
    .tool-card { max-width:1000px; transition: all 0.3s ease; }
    .tool-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
    canvas { background:#fff; border-radius: 8px; }
    .drop-zone.active { border-color: #3b82f6; background-color: #eff6ff; }
    .progress-bar { height: 6px; background-color: #e5e7eb; border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; background-color: #3b82f6; transition: width 0.3s ease; }
    .tooltip { position: relative; }
    .tooltip-text { visibility: hidden; width: 200px; background-color: #1f2937; color: white; text-align: center; border-radius: 6px; padding: 5px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -100px; opacity: 0; transition: opacity 0.3s; }
    .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
    
    /* Mobile fixes for sidebar */
    @media (max-width: 768px) { 
      #sidebar { position: sticky; top:0; z-index:30; }
      .mobile-menu-btn { display: block; }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      .dark-mode-auto { background-color: #1e293b; color: #f1f5f9; }
      .dark-mode-auto .bg-white { background-color: #334155; }
      .dark-mode-auto .bg-slate-50 { background-color: #475569; }
      .dark-mode-auto .text-slate-800 { color: #e2e8f0; }
      .dark-mode-auto .text-slate-500 { color: #94a3b8; }
      .dark-mode-auto .border { border-color: #475569; }
    }
    
    /* Animation for loading states */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .loading { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    
    /* PDF tools grid */
    .pdf-tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 dark-mode-auto">
  <header class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4 shadow-md">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="text-xl font-bold flex items-center gap-2">
          <i class="fas fa-tools"></i>
          MediaToolsHub
        </div>
        <span class="text-xs bg-blue-500 px-2 py-1 rounded-full">v2.0</span>
      </div>
      <div class="flex items-center gap-4">
        <div class="hidden md:flex items-center gap-2 text-sm">
          <i class="fas fa-shield-alt"></i>
          <span>100% Private</span>
        </div>
        <div class="hidden md:flex items-center gap-2 text-sm">
          <i class="fas fa-bolt"></i>
          <span>Client-Side</span>
        </div>
        <button id="themeToggle" class="p-2 rounded-full bg-blue-500 hover:bg-blue-400 transition-colors">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>
  </header>

  <div class="max-w-7xl mx-auto p-4 md:flex md:gap-6">
    <!-- Sidebar -->
    <aside id="sidebar" class="w-full md:w-64 bg-white rounded-lg shadow p-4 mb-4 md:mb-0">
      <div class="flex justify-between items-center mb-4 md:hidden">
        <h2 class="font-semibold">Tools Menu</h2>
        <button id="mobileMenuToggle" class="p-2 rounded-md bg-slate-100">
          <i class="fas fa-bars"></i>
        </button>
      </div>
      
      <nav id="sidebarNav" class="space-y-2">
        <button data-target="images" class="tool-btn w-full text-left flex items-center gap-3 p-3 rounded-md bg-blue-50 text-blue-700 font-medium">
          <i class="fa-solid fa-image text-blue-600 w-6"></i> 
          <span>Image Tools</span>
        </button>
        <button data-target="video" class="tool-btn w-full text-left flex items-center gap-3 p-3 rounded-md hover:bg-slate-50 text-slate-700">
          <i class="fa-solid fa-video text-red-500 w-6"></i> 
          <span>Video Tools</span>
        </button>
        <button data-target="pdf" class="tool-btn w-full text-left flex items-center gap-3 p-3 rounded-md hover:bg-slate-50 text-slate-700">
          <i class="fa-solid fa-file-pdf text-orange-500 w-6"></i> 
          <span>PDF Tools</span>
        </button>
        <button data-target="extras" class="tool-btn w-full text-left flex items-center gap-3 p-3 rounded-md hover:bg-slate-50 text-slate-700">
          <i class="fa-solid fa-th-list text-green-600 w-6"></i> 
          <span>Extras</span>
        </button>
      </nav>

      <div class="mt-6 text-center">
        <div class="p-3 border border-dashed border-slate-300 rounded-lg text-slate-500">
          <div class="text-sm font-medium mb-1">Ad Space</div>
          <div class="text-xs">Paste ad code here</div>
        </div>
      </div>
      
      <div class="mt-6 text-xs text-slate-500 text-center">
        <p>All processing happens in your browser</p>
        <p class="mt-1">No data is sent to servers</p>
      </div>
    </aside>

    <!-- Content -->
    <main class="flex-1">
      <!-- Images Section -->
      <section id="images" class="tool-card bg-white p-6 rounded-lg shadow">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-bold text-slate-800">Image Tools</h2>
            <p class="text-slate-500 mt-1">Compress, resize, convert, and crop images directly in your browser</p>
          </div>
          <div class="mt-2 md:mt-0 flex items-center gap-2 text-sm text-slate-500 bg-slate-50 px-3 py-2 rounded-full">
            <i class="fas fa-lock"></i>
            <span>Private & Secure</span>
          </div>
        </div>

        <div class="grid gap-6 md:grid-cols-2">
          <!-- Left column: uploader + controls -->
          <div class="space-y-6">
            <div class="p-6 border-2 border-dashed border-slate-200 rounded-xl text-center transition-colors" id="imageDrop">
              <div class="flex flex-col items-center justify-center gap-3">
                <div class="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center">
                  <i class="fas fa-cloud-upload-alt text-blue-500 text-xl"></i>
                </div>
                <div>
                  <p class="font-medium">Drop your image here</p>
                  <p class="text-sm text-slate-500 mt-1">or click to browse</p>
                </div>
              </div>
              <input id="imageFileInput" type="file" accept="image/*" class="hidden" />
              <button id="browseImage" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Select Image</button>
              <div class="mt-3 text-xs text-slate-400">Supports: JPG, PNG, WebP, GIF, SVG</div>
            </div>

            <div class="bg-slate-50 rounded-xl p-4">
              <label class="block text-sm font-medium mb-3">Select Tool</label>
              <div class="grid grid-cols-2 gap-2">
                <button id="tabCompress" class="px-4 py-3 rounded-lg bg-blue-600 text-white text-sm font-medium flex items-center justify-center gap-2">
                  <i class="fas fa-compress-alt"></i>
                  <span>Compress</span>
                </button>
                <button id="tabResize" class="px-4 py-3 rounded-lg bg-slate-100 text-slate-700 text-sm font-medium flex items-center justify-center gap-2 hover:bg-slate-200 transition-colors">
                  <i class="fas fa-expand-alt"></i>
                  <span>Resize</span>
                </button>
                <button id="tabConvert" class="px-4 py-3 rounded-lg bg-slate-100 text-slate-700 text-sm font-medium flex items-center justify-center gap-2 hover:bg-slate-200 transition-colors">
                  <i class="fas fa-exchange-alt"></i>
                  <span>Convert</span>
                </button>
                <button id="tabCrop" class="px-4 py-3 rounded-lg bg-slate-100 text-slate-700 text-sm font-medium flex items-center justify-center gap-2 hover:bg-slate-200 transition-colors">
                  <i class="fas fa-crop-alt"></i>
                  <span>Crop</span>
                </button>
              </div>
            </div>

            <!-- Tool panels -->
            <div id="panelCompress" class="tool-panel border border-slate-200 rounded-xl p-5 bg-white">
              <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
                <i class="fas fa-compress-alt text-blue-500"></i>
                Image Compression
              </h3>
              
              <div class="space-y-4">
                <div>
                  <div class="flex justify-between mb-1">
                    <label class="text-sm font-medium">Quality</label>
                    <span id="compressQVal" class="font-medium text-blue-600">80%</span>
                  </div>
                  <input id="compressQuality" type="range" min="10" max="100" value="80" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" />
                  <div class="flex justify-between text-xs text-slate-500 mt-1">
                    <span>Smaller File</span>
                    <span>Better Quality</span>
                  </div>
                </div>
                
                <div class="flex items-center gap-2">
                  <input id="compressKeepMetadata" type="checkbox" class="rounded text-blue-600" checked />
                  <label for="compressKeepMetadata" class="text-sm">Keep image metadata (EXIF)</label>
                </div>
                
                <div class="pt-2">
                  <button id="compressRun" class="w-full py-3 bg-blue-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-blue-700 transition-colors">
                    <i class="fas fa-download"></i>
                    Compress & Download
                  </button>
                  <div id="compressStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
                </div>
              </div>
            </div>

            <div id="panelResize" class="hidden tool-panel border border-slate-200 rounded-xl p-5 bg-white">
              <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
                <i class="fas fa-expand-alt text-green-500"></i>
                Image Resize
              </h3>
              
              <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Width (px)</label>
                    <input id="resizeW" type="number" class="w-full border border-slate-300 rounded-lg px-3 py-2" placeholder="Auto" />
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-1">Height (px)</label>
                    <input id="resizeH" type="number" class="w-full border border-slate-300 rounded-lg px-3 py-2" placeholder="Auto" />
                  </div>
                </div>
                
                <div class="flex items-center gap-2">
                  <input id="keepAspect" type="checkbox" class="rounded text-blue-600" checked />
                  <label for="keepAspect" class="text-sm">Maintain aspect ratio</label>
                </div>
                
                <div class="pt-2">
                  <button id="resizeRun" class="w-full py-3 bg-green-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-green-700 transition-colors">
                    <i class="fas fa-download"></i>
                    Resize & Download
                  </button>
                  <div id="resizeStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
                </div>
              </div>
            </div>

            <div id="panelConvert" class="hidden tool-panel border border-slate-200 rounded-xl p-5 bg-white">
              <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
                <i class="fas fa-exchange-alt text-purple-500"></i>
                Format Conversion
              </h3>
              
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium mb-1">Output Format</label>
                  <select id="convertFormatSel" class="w-full border border-slate-300 rounded-lg px-3 py-2">
                    <option value="image/webp">WebP (Modern)</option>
                    <option value="image/jpeg">JPEG (Standard)</option>
                    <option value="image/png">PNG (Lossless)</option>
                    <option value="image/gif">GIF (Animation)</option>
                  </select>
                </div>
                
                <div class="pt-2">
                  <button id="convertRun" class="w-full py-3 bg-purple-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-purple-700 transition-colors">
                    <i class="fas fa-download"></i>
                    Convert & Download
                  </button>
                  <div id="convertStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
                </div>
              </div>
            </div>

            <div id="panelCrop" class="hidden tool-panel border border-slate-200 rounded-xl p-5 bg-white">
              <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
                <i class="fas fa-crop-alt text-pink-500"></i>
                Image Cropping
              </h3>
              
              <div class="space-y-4">
                <div class="text-sm text-slate-600">
                  <p>Drag on the preview to select the area you want to keep.</p>
                </div>
                
                <div class="pt-2">
                  <button id="cropRun" class="w-full py-3 bg-pink-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-pink-700 transition-colors">
                    <i class="fas fa-download"></i>
                    Download Cropped Image
                  </button>
                  <div id="cropStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right column: preview -->
          <div class="space-y-6">
            <div class="border border-slate-200 rounded-xl bg-white p-5">
              <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
                <i class="fas fa-eye text-slate-500"></i>
                Preview
              </h3>
              <div id="imgPreviewWrap" class="flex items-center justify-center min-h-[200px] border border-dashed border-slate-300 rounded-lg bg-slate-50">
                <div class="text-center p-6">
                  <i class="fas fa-image text-slate-300 text-4xl mb-3"></i>
                  <p class="text-slate-400">No image loaded</p>
                </div>
              </div>
              <canvas id="cropCanvas" class="mt-4 border border-slate-300 rounded-lg w-full" style="display:none"></canvas>
            </div>
            
            <div class="border border-slate-200 rounded-xl bg-white p-5">
              <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
                <i class="fas fa-info-circle text-slate-500"></i>
                Image Details
              </h3>
              <div id="imgMeta" class="text-sm text-slate-600">
                <div class="flex flex-col space-y-2">
                  <div class="flex justify-between">
                    <span class="text-slate-500">Name:</span>
                    <span>—</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-slate-500">Size:</span>
                    <span>—</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-slate-500">Dimensions:</span>
                    <span>—</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-slate-500">Type:</span>
                    <span>—</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Video Section -->
      <section id="video" class="hidden tool-card bg-white p-6 rounded-lg shadow">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-bold text-slate-800">Video Tools</h2>
            <p class="text-slate-500 mt-1">Compress videos directly in your browser (WebM format)</p>
          </div>
          <div class="mt-2 md:mt-0 flex items-center gap-2 text-sm text-slate-500 bg-slate-50 px-3 py-2 rounded-full">
            <i class="fas fa-info-circle"></i>
            <span>Browser-dependent performance</span>
          </div>
        </div>

        <div class="grid gap-6 md:grid-cols-2">
          <div class="space-y-6">
            <div class="p-6 border-2 border-dashed border-slate-200 rounded-xl text-center transition-colors" id="videoDrop">
              <div class="flex flex-col items-center justify-center gap-3">
                <div class="w-12 h-12 rounded-full bg-red-50 flex items-center justify-center">
                  <i class="fas fa-video text-red-500 text-xl"></i>
                </div>
                <div>
                  <p class="font-medium">Drop your video here</p>
                  <p class="text-sm text-slate-500 mt-1">or click to browse</p>
                </div>
              </div>
              <input id="videoInputFile" type="file" accept="video/*" class="hidden" />
              <button id="browseVideo" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">Select Video</button>
              <div class="mt-3 text-xs text-slate-400">Supports: MP4, WebM, MOV, AVI</div>
            </div>

            <div class="bg-white border border-slate-200 rounded-xl p-5">
              <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
                <i class="fas fa-cog text-red-500"></i>
                Compression Settings
              </h3>
              
              <div class="space-y-5">
                <div>
                  <div class="flex justify-between mb-1">
                    <label class="text-sm font-medium">Scale</label>
                    <span id="videoScaleVal" class="font-medium text-red-600">50%</span>
                  </div>
                  <input id="videoScaleIn" type="range" min="10" max="100" value="50" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" />
                  <div class="flex justify-between text-xs text-slate-500 mt-1">
                    <span>Smaller Size</span>
                    <span>Better Quality</span>
                  </div>
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-1">Bitrate (kbps)</label>
                  <select id="videoBitrate" class="w-full border border-slate-300 rounded-lg px-3 py-2">
                    <option value="500">500 (Low)</option>
                    <option value="1000" selected>1000 (Medium)</option>
                    <option value="2000">2000 (High)</option>
                    <option value="5000">5000 (Very High)</option>
                  </select>
                </div>
                
                <div class="pt-2">
                  <button id="videoRunBtn" class="w-full py-3 bg-red-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-red-700 transition-colors">
                    <i class="fas fa-download"></i>
                    Compress & Download
                  </button>
                  <div id="videoStatusTxt" class="text-sm text-slate-500 mt-2 text-center"></div>
                  <div id="videoProgress" class="progress-bar mt-2 hidden">
                    <div id="videoProgressFill" class="progress-fill" style="width: 0%"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="space-y-6">
            <div class="border border-slate-200 rounded-xl bg-white p-5">
              <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
                <i class="fas fa-play-circle text-slate-500"></i>
                Video Preview
              </h3>
              <div class="p-4 border border-slate-200 rounded-lg bg-slate-50 flex items-center justify-center min-h-[200px]">
                <video id="videoPreviewEl" controls class="w-full rounded-lg" style="display:none"></video>
                <div id="videoPlaceholder" class="text-center p-6">
                  <i class="fas fa-video text-slate-300 text-4xl mb-3"></i>
                  <p class="text-slate-400">No video loaded</p>
                </div>
              </div>
            </div>
            
            <div class="border border-slate-200 rounded-xl bg-white p-5">
              <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
                <i class="fas fa-info-circle text-slate-500"></i>
                Video Details
              </h3>
              <div id="videoMeta" class="text-sm text-slate-600">
                <div class="flex flex-col space-y-2">
                  <div class="flex justify-between">
                    <span class="text-slate-500">Name:</span>
                    <span>—</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-slate-500">Size:</span>
                    <span>—</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-slate-500">Duration:</span>
                    <span>—</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-slate-500">Type:</span>
                    <span>—</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- PDF Section -->
      <section id="pdf" class="hidden tool-card bg-white p-6 rounded-lg shadow">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-bold text-slate-800">PDF Tools</h2>
            <p class="text-slate-500 mt-1">Convert, merge, split, compress and manipulate PDF files directly in your browser</p>
          </div>
          <div class="mt-2 md:mt-0 flex items-center gap-2 text-sm text-slate-500 bg-slate-50 px-3 py-2 rounded-full">
            <i class="fas fa-code"></i>
            <span>pdf.js + pdf-lib</span>
          </div>
        </div>

        <div class="pdf-tools-grid mb-8">
          <!-- PDF to Images -->
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-file-pdf text-orange-500"></i>
              PDF to Images
            </h3>
            <p class="text-sm text-slate-500 mb-4">Convert PDF pages to image files</p>
            <div class="space-y-4">
              <div class="p-3 border-2 border-dashed border-slate-200 rounded-lg text-center">
                <input id="pdfToImgsFile" type="file" accept="application/pdf" class="hidden" />
                <button id="browsePdfToImg" class="px-3 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-sm">Select PDF</button>
              </div>
              <div>
                <button id="pdfToImgsBtn" class="w-full py-2 bg-orange-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-orange-600 transition-colors text-sm">
                  <i class="fas fa-download"></i>
                  Convert Pages
                </button>
                <div id="pdfToImgsStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
              </div>
            </div>
          </div>

          <!-- Images to PDF -->
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-images text-emerald-500"></i>
              Images to PDF
            </h3>
            <p class="text-sm text-slate-500 mb-4">Combine multiple images into a PDF</p>
            <div class="space-y-4">
              <div class="p-3 border-2 border-dashed border-slate-200 rounded-lg text-center">
                <input id="imgsToPdfFile" type="file" accept="image/*" multiple class="hidden" />
                <button id="browseImgsToPdf" class="px-3 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors text-sm">Select Images</button>
              </div>
              <div>
                <button id="imgsToPdfBtn" class="w-full py-2 bg-emerald-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-emerald-600 transition-colors text-sm">
                  <i class="fas fa-download"></i>
                  Create PDF
                </button>
                <div id="imgsToPdfStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
              </div>
            </div>
          </div>

          <!-- Merge PDFs -->
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-object-group text-blue-500"></i>
              Merge PDFs
            </h3>
            <p class="text-sm text-slate-500 mb-4">Combine multiple PDFs into one document</p>
            <div class="space-y-4">
              <div class="p-3 border-2 border-dashed border-slate-200 rounded-lg text-center">
                <input id="mergePdfFiles" type="file" accept="application/pdf" multiple class="hidden" />
                <button id="browseMergePdf" class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm">Select PDFs</button>
              </div>
              <div>
                <button id="mergePdfBtn" class="w-full py-2 bg-blue-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-blue-600 transition-colors text-sm">
                  <i class="fas fa-download"></i>
                  Merge PDFs
                </button>
                <div id="mergePdfStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
              </div>
            </div>
          </div>

          <!-- Split PDF -->
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-cut text-purple-500"></i>
              Split PDF
            </h3>
            <p class="text-sm text-slate-500 mb-4">Extract specific pages or split into multiple PDFs</p>
            <div class="space-y-4">
              <div class="p-3 border-2 border-dashed border-slate-200 rounded-lg text-center">
                <input id="splitPdfFile" type="file" accept="application/pdf" class="hidden" />
                <button id="browseSplitPdf" class="px-3 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm">Select PDF</button>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Pages to extract (e.g., 1-3,5,7-9)</label>
                <input id="splitPages" type="text" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm" placeholder="All pages" />
              </div>
              <div>
                <button id="splitPdfBtn" class="w-full py-2 bg-purple-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-purple-600 transition-colors text-sm">
                  <i class="fas fa-download"></i>
                  Split PDF
                </button>
                <div id="splitPdfStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
              </div>
            </div>
          </div>

          <!-- Compress PDF -->
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-compress-alt text-red-500"></i>
              Compress PDF
            </h3>
            <p class="text-sm text-slate-500 mb-4">Reduce PDF file size while maintaining quality</p>
            <div class="space-y-4">
              <div class="p-3 border-2 border-dashed border-slate-200 rounded-lg text-center">
                <input id="compressPdfFile" type="file" accept="application/pdf" class="hidden" />
                <button id="browseCompressPdf" class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm">Select PDF</button>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Compression Level</label>
                <select id="compressPdfLevel" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm">
                  <option value="low">Low (Better Quality)</option>
                  <option value="medium" selected>Medium (Balanced)</option>
                  <option value="high">High (Smaller Size)</option>
                </select>
              </div>
              <div>
                <button id="compressPdfBtn" class="w-full py-2 bg-red-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-red-600 transition-colors text-sm">
                  <i class="fas fa-download"></i>
                  Compress PDF
                </button>
                <div id="compressPdfStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
              </div>
            </div>
          </div>

          <!-- Lock PDF -->
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-lock text-amber-500"></i>
              Lock PDF
            </h3>
            <p class="text-sm text-slate-500 mb-4">Add password protection to PDF files</p>
            <div class="space-y-4">
              <div class="p-3 border-2 border-dashed border-slate-200 rounded-lg text-center">
                <input id="lockPdfFile" type="file" accept="application/pdf" class="hidden" />
                <button id="browseLockPdf" class="px-3 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors text-sm">Select PDF</button>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Password</label>
                <input id="lockPdfPassword" type="password" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm" placeholder="Enter password" />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Confirm Password</label>
                <input id="lockPdfConfirmPassword" type="password" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm" placeholder="Confirm password" />
              </div>
              <div>
                <button id="lockPdfBtn" class="w-full py-2 bg-amber-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-amber-600 transition-colors text-sm">
                  <i class="fas fa-download"></i>
                  Lock PDF
                </button>
                <div id="lockPdfStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
              </div>
            </div>
          </div>

          <!-- Unlock PDF -->
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-unlock text-green-500"></i>
              Unlock PDF
            </h3>
            <p class="text-sm text-slate-500 mb-4">Remove password protection from PDF files</p>
            <div class="space-y-4">
              <div class="p-3 border-2 border-dashed border-slate-200 rounded-lg text-center">
                <input id="unlockPdfFile" type="file" accept="application/pdf" class="hidden" />
                <button id="browseUnlockPdf" class="px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm">Select PDF</button>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">PDF Password</label>
                <input id="unlockPdfPassword" type="password" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm" placeholder="Enter PDF password" />
              </div>
              <div>
                <button id="unlockPdfBtn" class="w-full py-2 bg-green-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-green-600 transition-colors text-sm">
                  <i class="fas fa-download"></i>
                  Unlock PDF
                </button>
                <div id="unlockPdfStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
              </div>
            </div>
          </div>

          <!-- Text to PDF -->
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-file-alt text-indigo-500"></i>
              Text to PDF
            </h3>
            <p class="text-sm text-slate-500 mb-4">Convert plain text files to PDF format</p>
            <div class="space-y-4">
              <div class="p-3 border-2 border-dashed border-slate-200 rounded-lg text-center">
                <input id="textToPdfFile" type="file" accept=".txt,.text" class="hidden" />
                <button id="browseTextToPdf" class="px-3 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors text-sm">Select Text File</button>
              </div>
              <div>
                <button id="textToPdfBtn" class="w-full py-2 bg-indigo-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-indigo-600 transition-colors text-sm">
                  <i class="fas fa-download"></i>
                  Create PDF
                </button>
                <div id="textToPdfStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
              </div>
            </div>
          </div>

          <!-- HTML to PDF -->
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-code text-pink-500"></i>
              HTML to PDF
            </h3>
            <p class="text-sm text-slate-500 mb-4">Convert HTML files or URLs to PDF format</p>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-1">HTML Content</label>
                <textarea id="htmlToPdfContent" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm h-24" placeholder="Paste HTML code or URL"></textarea>
              </div>
              <div>
                <button id="htmlToPdfBtn" class="w-full py-2 bg-pink-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-pink-600 transition-colors text-sm">
                  <i class="fas fa-download"></i>
                  Create PDF
                </button>
                <div id="htmlToPdfStatus" class="text-sm text-slate-500 mt-2 text-center"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="border-t border-slate-200 pt-6">
          <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
            <i class="fas fa-eye text-slate-500"></i>
            PDF Preview
          </h3>
          <div id="pdfPreviewArea" class="p-4 border border-slate-200 rounded-lg bg-slate-50 min-h-[400px] overflow-auto flex flex-col items-center justify-center">
            <i class="fas fa-file-pdf text-slate-300 text-4xl mb-3"></i>
            <p class="text-slate-400">PDF preview will appear here</p>
          </div>
        </div>
      </section>

      <!-- Extras Section -->
      <section id="extras" class="hidden tool-card bg-white p-6 rounded-lg shadow">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-bold text-slate-800">Extra Tools</h2>
            <p class="text-slate-500 mt-1">Additional utilities for your media files</p>
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-qrcode text-indigo-500"></i>
              QR Code Generator
            </h3>
            <p class="text-sm text-slate-500 mb-4">Generate QR codes for URLs, text, or contact information</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-1">Content</label>
                <textarea id="qrText" class="w-full border border-slate-300 rounded-lg px-3 py-2 h-24" placeholder="Enter text or URL to encode"></textarea>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-1">Size</label>
                  <select id="qrSize" class="w-full border border-slate-300 rounded-lg px-3 py-2">
                    <option value="200">Small (200px)</option>
                    <option value="300" selected>Medium (300px)</option>
                    <option value="400">Large (400px)</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-1">Color</label>
                  <select id="qrColor" class="w-full border border-slate-300 rounded-lg px-3 py-2">
                    <option value="#000000">Black</option>
                    <option value="#3b82f6">Blue</option>
                    <option value="#ef4444">Red</option>
                    <option value="#10b981">Green</option>
                  </select>
                </div>
              </div>
              
              <div class="pt-2">
                <button id="genQrBtn" class="w-full py-3 bg-indigo-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-indigo-700 transition-colors">
                  <i class="fas fa-qrcode"></i>
                  Generate QR Code
                </button>
                <div id="qrOut" class="mt-4 flex justify-center"></div>
              </div>
            </div>
          </div>

          <div class="p-5 border border-slate-200 rounded-xl bg-white">
            <h3 class="font-medium text-lg mb-4 flex items-center gap-2">
              <i class="fas fa-camera text-amber-500"></i>
              Image Metadata (EXIF)
            </h3>
            <p class="text-sm text-slate-500 mb-4">View or remove EXIF metadata from your images</p>
            
            <div class="space-y-4">
              <div class="p-4 border-2 border-dashed border-slate-200 rounded-lg text-center">
                <input id="exifFile" type="file" accept="image/*" class="hidden" />
                <button id="browseExif" class="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors">Select Image</button>
                <div class="mt-2 text-xs text-slate-500">JPG and TIFF files contain EXIF data</div>
              </div>
              
              <div class="flex gap-2">
                <button id="viewExifBtn" class="flex-1 py-2 bg-amber-500 text-white rounded-lg font-medium hover:bg-amber-600 transition-colors">View EXIF</button>
                <button id="removeExifBtn" class="flex-1 py-2 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors">Remove EXIF</button>
              </div>
              
              <div id="exifOut" class="mt-4 p-3 border border-slate-200 rounded-lg bg-slate-50 max-h-40 overflow-auto text-sm"></div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <footer class="max-w-7xl mx-auto p-6 text-sm text-slate-500 border-t border-slate-200 mt-8">
    <div class="flex flex-col md:flex-row justify-between items-center">
      <div class="flex items-center gap-2 mb-4 md:mb-0">
        <i class="fas fa-shield-alt text-blue-500"></i>
        <span>Built with care — your files never leave your browser</span>
      </div>
      <div class="flex gap-4">
        <a href="#" class="hover:text-blue-500 transition-colors">Privacy</a>
        <a href="#" class="hover:text-blue-500 transition-colors">Terms</a>
        <a href="#" class="hover:text-blue-500 transition-colors">Feedback</a>
      </div>
    </div>
  </footer>

  <!-- Small third-party libraries -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/exifr/dist/full.umd.min.js"></script>

  <script>
  // ---------- Core UI behavior ----------
  document.addEventListener('DOMContentLoaded', function() {
    // Tool navigation
    document.querySelectorAll('#sidebar .tool-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('#sidebar .tool-btn').forEach(b => {
          b.classList.remove('bg-blue-50', 'text-blue-700', 'font-medium');
          b.classList.add('text-slate-700');
        });
        btn.classList.add('bg-blue-50', 'text-blue-700', 'font-medium');
        btn.classList.remove('text-slate-700');
        
        const target = btn.getAttribute('data-target');
        document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
        document.getElementById(target).classList.remove('hidden');
        
        window.scrollTo({top: 0, behavior: 'smooth'});
      });
    });

    // Mobile menu toggle
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const sidebarNav = document.getElementById('sidebarNav');
    
    if (mobileMenuToggle) {
      mobileMenuToggle.addEventListener('click', () => {
        sidebarNav.classList.toggle('hidden');
        sidebarNav.classList.toggle('block');
      });
    }

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = themeToggle.querySelector('i');
    
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode-auto');
      
      if (document.body.classList.contains('dark-mode-auto')) {
        themeIcon.classList.remove('fa-moon');
        themeIcon.classList.add('fa-sun');
      } else {
        themeIcon.classList.remove('fa-sun');
        themeIcon.classList.add('fa-moon');
      }
    });

    // Initialize tooltips
    initializeTooltips();
  });

  function initializeTooltips() {
    // Add tooltips to important elements
    const tooltipElements = [
      { selector: '#compressQuality', text: 'Lower values create smaller files with reduced quality' },
      { selector: '#videoScaleIn', text: 'Reduce video dimensions to decrease file size' },
      { selector: '#keepAspect', text: 'Maintain original width/height ratio when resizing' }
    ];
    
    tooltipElements.forEach(item => {
      const element = document.querySelector(item.selector);
      if (element) {
        element.parentElement.classList.add('tooltip');
        
        const tooltip = document.createElement('span');
        tooltip.className = 'tooltip-text';
        tooltip.textContent = item.text;
        element.parentElement.appendChild(tooltip);
      }
    });
  }

  // Image drag & browse
  const drop = document.getElementById('imageDrop');
  const fileInput = document.getElementById('imageFileInput');
  const browseBtn = document.getElementById('browseImage');
  
  browseBtn.addEventListener('click', () => fileInput.click());
  
  ['dragenter', 'dragover'].forEach(ev => {
    drop.addEventListener(ev, e => {
      e.preventDefault();
      drop.classList.add('active');
    });
  });
  
  ['dragleave', 'drop'].forEach(ev => {
    drop.addEventListener(ev, e => {
      e.preventDefault();
      drop.classList.remove('active');
    });
  });
  
  drop.addEventListener('drop', e => {
    const f = e.dataTransfer.files[0];
    if (f && f.type.startsWith('image/')) {
      loadImageFile(f);
    } else {
      showNotification('Please drop a valid image file', 'error');
    }
  });
  
  fileInput.addEventListener('change', e => {
    if (e.target.files[0]) {
      loadImageFile(e.target.files[0]);
    }
  });

  // Video file handling
  const videoDrop = document.getElementById('videoDrop');
  const videoInput = document.getElementById('videoInputFile');
  const browseVideoBtn = document.getElementById('browseVideo');
  
  browseVideoBtn.addEventListener('click', () => videoInput.click());
  
  ['dragenter', 'dragover'].forEach(ev => {
    videoDrop.addEventListener(ev, e => {
      e.preventDefault();
      videoDrop.classList.add('active');
    });
  });
  
  ['dragleave', 'drop'].forEach(ev => {
    videoDrop.addEventListener(ev, e => {
      e.preventDefault();
      videoDrop.classList.remove('active');
    });
  });
  
  videoDrop.addEventListener('drop', e => {
    const f = e.dataTransfer.files[0];
    if (f && f.type.startsWith('video/')) {
      loadVideoFile(f);
    } else {
      showNotification('Please drop a valid video file', 'error');
    }
  });
  
  videoInput.addEventListener('change', e => {
    if (e.target.files[0]) {
      loadVideoFile(e.target.files[0]);
    }
  });

  // PDF file browsing buttons
  document.getElementById('browsePdfToImg').addEventListener('click', () => document.getElementById('pdfToImgsFile').click());
  document.getElementById('browseImgsToPdf').addEventListener('click', () => document.getElementById('imgsToPdfFile').click());
  document.getElementById('browseMergePdf').addEventListener('click', () => document.getElementById('mergePdfFiles').click());
  document.getElementById('browseSplitPdf').addEventListener('click', () => document.getElementById('splitPdfFile').click());
  document.getElementById('browseCompressPdf').addEventListener('click', () => document.getElementById('compressPdfFile').click());
  document.getElementById('browseLockPdf').addEventListener('click', () => document.getElementById('lockPdfFile').click());
  document.getElementById('browseUnlockPdf').addEventListener('click', () => document.getElementById('unlockPdfFile').click());
  document.getElementById('browseTextToPdf').addEventListener('click', () => document.getElementById('textToPdfFile').click());
  document.getElementById('browseExif').addEventListener('click', () => document.getElementById('exifFile').click());

  // Tab switching inside image tools
  const tabMap = {
    tabCompress: 'panelCompress',
    tabResize: 'panelResize',
    tabConvert: 'panelConvert',
    tabCrop: 'panelCrop'
  };
  
  Object.keys(tabMap).forEach(id => {
    document.getElementById(id).addEventListener('click', () => {
      // Update button styles
      Object.keys(tabMap).forEach(tabId => {
        const btn = document.getElementById(tabId);
        if (tabId === id) {
          btn.classList.remove('bg-slate-100', 'text-slate-700', 'hover:bg-slate-200');
          btn.classList.add('bg-blue-600', 'text-white');
        } else {
          btn.classList.remove('bg-blue-600', 'text-white');
          btn.classList.add('bg-slate-100', 'text-slate-700', 'hover:bg-slate-200');
        }
      });
      
      // Show/hide panels
      Object.values(tabMap).forEach(p => document.getElementById(p).classList.add('hidden'));
      document.getElementById(tabMap[id]).classList.remove('hidden');
      
      // Special handling for crop tab
      if (id === 'tabCrop' && loadedImage.img) {
        document.getElementById('cropCanvas').style.display = 'block';
        initializeCropCanvas();
      } else {
        document.getElementById('cropCanvas').style.display = 'none';
      }
    });
  });

  // Keep track of loaded image
  let loadedImage = { file: null, img: null, url: null };
  
  function clearLoadedImage() {
    if (loadedImage.url) URL.revokeObjectURL(loadedImage.url);
    loadedImage = { file: null, img: null, url: null };
    
    document.getElementById('imgPreviewWrap').innerHTML = `
      <div class="text-center p-6">
        <i class="fas fa-image text-slate-300 text-4xl mb-3"></i>
        <p class="text-slate-400">No image loaded</p>
      </div>
    `;
    
    updateImageMetadata();
  }
  
  function updateImageMetadata() {
    const metaEl = document.getElementById('imgMeta');
    if (loadedImage.img) {
      const sizeKB = (loadedImage.file.size / 1024).toFixed(2);
      const dimensions = `${loadedImage.img.width} × ${loadedImage.img.height}`;
      
      metaEl.innerHTML = `
        <div class="flex flex-col space-y-2">
          <div class="flex justify-between">
            <span class="text-slate-500">Name:</span>
            <span class="font-medium">${loadedImage.file.name}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-500">Size:</span>
            <span>${sizeKB} KB</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-500">Dimensions:</span>
            <span>${dimensions}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-500">Type:</span>
            <span>${loadedImage.file.type}</span>
          </div>
        </div>
      `;
    } else {
      metaEl.innerHTML = `
        <div class="flex flex-col space-y-2">
          <div class="flex justify-between">
            <span class="text-slate-500">Name:</span>
            <span>—</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-500">Size:</span>
            <span>—</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-500">Dimensions:</span>
            <span>—</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-500">Type:</span>
            <span>—</span>
          </div>
        </div>
      `;
    }
  }

  async function loadImageFile(file) {
    try {
      clearLoadedImage();
      const url = URL.createObjectURL(file);
      const img = new Image();
      
      img.onload = () => {
        loadedImage = { file, img, url };
        
        document.getElementById('imgPreviewWrap').innerHTML = `
          <img id="mainPreview" src="${url}" alt="preview" class="max-w-full h-auto rounded-lg" />
        `;
        
        updateImageMetadata();
        
        // Initialize crop canvas if crop tab is active
        if (document.getElementById('tabCrop').classList.contains('bg-blue-600')) {
          document.getElementById('cropCanvas').style.display = 'block';
          initializeCropCanvas();
        }
      };
      
      img.onerror = () => {
        clearLoadedImage();
        showNotification('Failed to load image', 'error');
      };
      
      img.src = url;
    } catch(err) {
      showNotification('Error loading image: ' + err.message, 'error');
    }
  }

  // Video file handling
  let loadedVideo = { file: null, url: null };
  
  function loadVideoFile(file) {
    if (loadedVideo.url) URL.revokeObjectURL(loadedVideo.url);
    
    const url = URL.createObjectURL(file);
    loadedVideo = { file, url };
    
    const videoEl = document.getElementById('videoPreviewEl');
    const placeholder = document.getElementById('videoPlaceholder');
    
    videoEl.src = url;
    videoEl.style.display = 'block';
    placeholder.style.display = 'none';
    
    // Update video metadata
    const metaEl = document.getElementById('videoMeta');
    const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
    
    metaEl.innerHTML = `
      <div class="flex flex-col space-y-2">
        <div class="flex justify-between">
          <span class="text-slate-500">Name:</span>
          <span class="font-medium">${file.name}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-slate-500">Size:</span>
          <span>${sizeMB} MB</span>
        </div>
        <div class="flex justify-between">
          <span class="text-slate-500">Duration:</span>
          <span>—</span>
        </div>
        <div class="flex justify-between">
          <span class="text-slate-500">Type:</span>
          <span>${file.type}</span>
        </div>
      </div>
    `;
    
    // Get video duration
    videoEl.addEventListener('loadedmetadata', () => {
      const duration = formatTime(videoEl.duration);
      metaEl.querySelector('div:nth-child(3) span:last-child').textContent = duration;
    });
  }

  // Utility function to format time
  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  }

  // ---------- Image operations ----------
  function canvasFromImage(img, w = img.width, h = img.height) {
    const c = document.createElement('canvas');
    c.width = w;
    c.height = h;
    c.getContext('2d').drawImage(img, 0, 0, w, h);
    return c;
  }

  // Compress
  document.getElementById('compressQuality').addEventListener('input', (e) => {
    document.getElementById('compressQVal').textContent = e.target.value + '%';
  });
  
  document.getElementById('compressRun').addEventListener('click', async () => {
    const status = document.getElementById('compressStatus');
    status.textContent = '';
    
    if (!loadedImage.img) {
      status.textContent = 'Please load an image first';
      return;
    }
    
    try {
      status.textContent = 'Processing...';
      status.classList.add('loading');
      
      const q = Number(document.getElementById('compressQuality').value) / 100;
      const canvas = canvasFromImage(loadedImage.img);
      
      canvas.toBlob(blob => {
        downloadBlob(blob, loadedImage.file.name.replace(/\.[^.]+$/, '') + '-compressed.jpg');
        status.textContent = 'Compression complete!';
        status.classList.remove('loading');
        
        const originalSize = loadedImage.file.size;
        const newSize = blob.size;
        const savings = ((originalSize - newSize) / originalSize * 100).toFixed(1);
        
        status.innerHTML = `Done! Reduced by ${savings}% (${formatFileSize(originalSize)} → ${formatFileSize(newSize)})`;
      }, 'image/jpeg', q);
    } catch(err) {
      status.textContent = 'Error: ' + err.message;
      status.classList.remove('loading');
    }
  });

  // Resize
  document.getElementById('resizeRun').addEventListener('click', async () => {
    const status = document.getElementById('resizeStatus');
    status.textContent = '';
    
    if (!loadedImage.img) {
      status.textContent = 'Please load an image first';
      return;
    }
    
    try {
      status.textContent = 'Processing...';
      status.classList.add('loading');
      
      let w = Number(document.getElementById('resizeW').value) || loadedImage.img.width;
      let h = Number(document.getElementById('resizeH').value) || loadedImage.img.height;
      
      if (document.getElementById('keepAspect').checked) {
        const ratio = loadedImage.img.width / loadedImage.img.height;
        if (w && !h) h = Math.round(w / ratio);
        else if (h && !w) w = Math.round(h * ratio);
      }
      
      const canvas = canvasFromImage(loadedImage.img, Math.max(1, w), Math.max(1, h));
      canvas.toBlob(blob => {
        downloadBlob(blob, loadedImage.file.name.replace(/\.[^.]+$/, '') + '-resized.jpg');
        status.textContent = 'Resize complete!';
        status.classList.remove('loading');
      }, 'image/jpeg', 0.92);
    } catch(err) {
      status.textContent = 'Error: ' + err.message;
      status.classList.remove('loading');
    }
  });

  // Convert
  document.getElementById('convertRun').addEventListener('click', async () => {
    const status = document.getElementById('convertStatus');
    status.textContent = '';
    
    if (!loadedImage.img) {
      status.textContent = 'Please load an image first';
      return;
    }
    
    try {
      status.textContent = 'Processing...';
      status.classList.add('loading');
      
      const fmt = document.getElementById('convertFormatSel').value;
      const canvas = canvasFromImage(loadedImage.img);
      
      canvas.toBlob(blob => {
        const ext = fmt.split('/')[1];
        downloadBlob(blob, loadedImage.file.name.replace(/\.[^.]+$/, '') + '-converted.' + ext);
        status.textContent = 'Conversion complete!';
        status.classList.remove('loading');
      }, fmt, 0.95);
    } catch(err) {
      status.textContent = 'Error: ' + err.message;
      status.classList.remove('loading');
    }
  });

  // Crop (visual) — uses start/end from mouse events
  function initializeCropCanvas() {
    const cv = document.getElementById('cropCanvas');
    if (!loadedImage.img) return;
    
    cv.width = loadedImage.img.width;
    cv.height = loadedImage.img.height;
    
    const ctx = cv.getContext('2d');
    ctx.drawImage(loadedImage.img, 0, 0);
    
    let isDrawing = false;
    let startX, startY, endX, endY;
    
    cv.addEventListener('mousedown', (e) => {
      isDrawing = true;
      const rect = cv.getBoundingClientRect();
      startX = e.clientX - rect.left;
      startY = e.clientY - rect.top;
      endX = startX;
      endY = startY;
    });
    
    cv.addEventListener('mousemove', (e) => {
      if (!isDrawing) return;
      
      const rect = cv.getBoundingClientRect();
      endX = e.clientX - rect.left;
      endY = e.clientY - rect.top;
      
      drawCropArea();
    });
    
    cv.addEventListener('mouseup', () => {
      isDrawing = false;
      document.getElementById('cropStatus').textContent = 'Crop area selected';
    });
    
    function drawCropArea() {
      // Redraw the original image
      ctx.drawImage(loadedImage.img, 0, 0);
      
      // Draw the selection rectangle
      ctx.strokeStyle = 'rgba(255, 59, 48, 0.9)';
      ctx.lineWidth = 2;
      ctx.strokeRect(startX, startY, endX - startX, endY - startY);
      
      // Draw semi-transparent overlay
      ctx.fillStyle = 'rgba(255, 59, 48, 0.1)';
      ctx.fillRect(startX, startY, endX - startX, endY - startY);
    }
    
    document.getElementById('cropRun').addEventListener('click', () => {
      if (!loadedImage.img) {
        document.getElementById('cropStatus').textContent = 'Please load an image first';
        return;
      }
      
      const width = Math.abs(endX - startX);
      const height = Math.abs(endY - startY);
      
      if (width <= 0 || height <= 0) {
        document.getElementById('cropStatus').textContent = 'Please select an area to crop';
        return;
      }
      
      const x = Math.min(startX, endX);
      const y = Math.min(startY, endY);
      
      const out = document.createElement('canvas');
      out.width = width;
      out.height = height;
      out.getContext('2d').drawImage(loadedImage.img, x, y, width, height, 0, 0, width, height);
      
      out.toBlob(blob => {
        downloadBlob(blob, loadedImage.file.name.replace(/\.[^.]+$/, '') + '-cropped.jpg');
        document.getElementById('cropStatus').textContent = 'Crop complete!';
      }, 'image/jpeg', 0.95);
    });
  }

  // Video compression
  document.getElementById('videoScaleIn').addEventListener('input', (e) => {
    document.getElementById('videoScaleVal').textContent = e.target.value + '%';
  });
  
  document.getElementById('videoRunBtn').addEventListener('click', async () => {
    const status = document.getElementById('videoStatusTxt');
    const progressBar = document.getElementById('videoProgress');
    const progressFill = document.getElementById('videoProgressFill');
    
    status.textContent = '';
    const f = videoInput.files[0];
    
    if (!f) {
      status.textContent = 'Please select a video file';
      return;
    }
    
    const scale = Math.max(0.1, Math.min(1, (Number(document.getElementById('videoScaleIn').value) || 50) / 100));
    const bitrate = Number(document.getElementById('videoBitrate').value) * 1000; // Convert to bps
    
    try {
      status.textContent = 'Processing video - this may take a while...';
      progressBar.classList.remove('hidden');
      progressFill.style.width = '10%';
      
      const url = URL.createObjectURL(f);
      const v = document.createElement('video');
      v.src = url;
      v.muted = true;
      
      await v.play().catch(() => {});
      await new Promise(resolve => { v.onloadedmetadata = resolve; });
      
      const cw = Math.max(1, Math.round(v.videoWidth * scale));
      const ch = Math.max(1, Math.round(v.videoHeight * scale));
      const c = document.createElement('canvas');
      c.width = cw;
      c.height = ch;
      const ctx = c.getContext('2d');
      
      const stream = c.captureStream(25);
      const mime = 'video/webm';
      const opts = {
        mimeType: mime,
        videoBitsPerSecond: bitrate
      };
      
      const recorder = new MediaRecorder(stream, opts);
      const chunks = [];
      
      recorder.ondataavailable = e => {
        if (e.data && e.data.size) {
          chunks.push(e.data);
          
          // Update progress (rough estimate)
          const progress = Math.min(95, 10 + (v.currentTime / v.duration) * 85);
          progressFill.style.width = `${progress}%`;
        }
      };
      
      recorder.start(1000);
      
      let raf;
      function draw() {
        if (v.ended || v.paused) {
          try {
            recorder.stop();
          } catch(e) {}
          return;
        }
        
        ctx.drawImage(v, 0, 0, cw, ch);
        raf = requestAnimationFrame(draw);
      }
      
      v.currentTime = 0;
      v.play();
      draw();
      
      recorder.onstop = () => {
        progressFill.style.width = '100%';
        const blob = new Blob(chunks, { type: mime });
        downloadBlob(blob, f.name.replace(/\.[^.]+$/, '') + '-compressed.webm');
        
        const videoEl = document.getElementById('videoPreviewEl');
        videoEl.src = URL.createObjectURL(blob);
        
        status.textContent = 'Compression complete!';
        progressBar.classList.add('hidden');
        
        URL.revokeObjectURL(url);
        if (raf) cancelAnimationFrame(raf);
      };
    } catch(err) {
      status.textContent = 'Error: ' + err.message;
      progressBar.classList.add('hidden');
    }
  });

  // ---------- PDF tools (pdf.js + pdf-lib) ----------
  if (window.pdfjsLib) {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js';
  }

  // PDF -> Images
  document.getElementById('pdfToImgsBtn').addEventListener('click', async () => {
    const stat = document.getElementById('pdfToImgsStatus');
    stat.textContent = '';
    const f = document.getElementById('pdfToImgsFile').files[0];
    
    if (!f) {
      stat.textContent = 'Please select a PDF file';
      return;
    }
    
    try {
      stat.textContent = 'Rendering PDF pages...';
      stat.classList.add('loading');
      
      const arr = await f.arrayBuffer();
      const loading = pdfjsLib.getDocument({ data: arr });
      const pdf = await loading.promise;
      const out = document.getElementById('pdfPreviewArea');
      out.innerHTML = '<p class="text-slate-500">Rendering pages...</p>';
      
      // Create a zip of all pages
      const zip = new JSZip();
      
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const vp = page.getViewport({ scale: 1.5 });
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = vp.width;
        canvas.height = vp.height;
        
        await page.render({ canvasContext: ctx, viewport: vp }).promise;
        const dataUrl = canvas.toDataURL('image/png');
        
        // Convert data URL to blob
        const response = await fetch(dataUrl);
        const blob = await response.blob();
        
        // Add to zip
        zip.file(`page-${i}.png`, blob);
        
        // Update preview area with first page
        if (i === 1) {
          out.innerHTML = '';
          const img = document.createElement('img');
          img.src = dataUrl;
          img.className = 'max-w-full h-auto border rounded-lg shadow';
          out.appendChild(img);
          
          const info = document.createElement('p');
          info.className = 'text-sm text-slate-500 mt-2 text-center';
          info.textContent = `Page 1 of ${pdf.numPages} (preview)`;
          out.appendChild(info);
        }
      }
      
      // Generate and download zip
      const zipBlob = await zip.generateAsync({ type: 'blob' });
      downloadBlob(zipBlob, f.name.replace(/\.[^.]+$/, '') + '-pages.zip');
      
      stat.textContent = `Converted ${pdf.numPages} pages successfully!`;
      stat.classList.remove('loading');
    } catch(err) {
      stat.textContent = 'Error: ' + err.message;
      stat.classList.remove('loading');
    }
  });

  // Images -> PDF
  document.getElementById('imgsToPdfBtn').addEventListener('click', async () => {
    const stat = document.getElementById('imgsToPdfStatus');
    stat.textContent = '';
    const files = Array.from(document.getElementById('imgsToPdfFile').files);
    
    if (!files.length) {
      stat.textContent = 'Please select at least one image';
      return;
    }
    
    try {
      stat.textContent = 'Creating PDF...';
      stat.classList.add('loading');
      
      const pdfDoc = await PDFLib.PDFDocument.create();
      
      for (const f of files) {
        const buf = await f.arrayBuffer();
        let img;
        
        if (f.type === 'image/png') {
          img = await pdfDoc.embedPng(buf);
        } else {
          img = await pdfDoc.embedJpg(buf);
        }
        
        const page = pdfDoc.addPage([img.width, img.height]);
        page.drawImage(img, {
          x: 0,
          y: 0,
          width: img.width,
          height: img.height,
        });
      }
      
      const bytes = await pdfDoc.save();
      downloadBlob(new Blob([bytes], { type: 'application/pdf' }), 'images-assembled.pdf');
      stat.textContent = `PDF created with ${files.length} pages!`;
      stat.classList.remove('loading');
    } catch(err) {
      stat.textContent = 'Error: ' + err.message;
      stat.classList.remove('loading');
    }
  });

  // Merge PDFs
  document.getElementById('mergePdfBtn').addEventListener('click', async () => {
    const stat = document.getElementById('mergePdfStatus');
    stat.textContent = '';
    const files = Array.from(document.getElementById('mergePdfFiles').files);
    
    if (!files.length) {
      stat.textContent = 'Please select at least one PDF file';
      return;
    }
    
    try {
      stat.textContent = 'Merging PDFs...';
      stat.classList.add('loading');
      
      const outPdf = await PDFLib.PDFDocument.create();
      
      for (const f of files) {
        const arr = await f.arrayBuffer();
        const donor = await PDFLib.PDFDocument.load(arr);
        const copied = await outPdf.copyPages(donor, donor.getPageIndices());
        copied.forEach(p => outPdf.addPage(p));
      }
      
      const out = await outPdf.save();
      downloadBlob(new Blob([out], { type: 'application/pdf' }), 'merged.pdf');
      stat.textContent = `Merged ${files.length} PDFs successfully!`;
      stat.classList.remove('loading');
    } catch(err) {
      stat.textContent = 'Error: ' + err.message;
      stat.classList.remove('loading');
    }
  });

  // Split PDF
  document.getElementById('splitPdfBtn').addEventListener('click', async () => {
    const stat = document.getElementById('splitPdfStatus');
    stat.textContent = '';
    const f = document.getElementById('splitPdfFile').files[0];
    
    if (!f) {
      stat.textContent = 'Please select a PDF file';
      return;
    }
    
    try {
      stat.textContent = 'Splitting PDF...';
      stat.classList.add('loading');
      
      const arr = await f.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arr);
      const pageCount = pdfDoc.getPageCount();
      
      // Parse page ranges
      const pageRanges = parsePageRanges(document.getElementById('splitPages').value, pageCount);
      
      if (pageRanges.length === 0) {
        // If no specific pages, split into individual pages
        const zip = new JSZip();
        
        for (let i = 0; i < pageCount; i++) {
          const newPdf = await PDFLib.PDFDocument.create();
          const [copiedPage] = await newPdf.copyPages(pdfDoc, [i]);
          newPdf.addPage(copiedPage);
          
          const pdfBytes = await newPdf.save();
          zip.file(`page-${i+1}.pdf`, pdfBytes);
        }
        
        const zipBlob = await zip.generateAsync({ type: 'blob' });
        downloadBlob(zipBlob, f.name.replace(/\.[^.]+$/, '') + '-split.zip');
        stat.textContent = `Split into ${pageCount} individual pages!`;
      } else {
        // Extract specific pages
        const newPdf = await PDFLib.PDFDocument.create();
        const copiedPages = await newPdf.copyPages(pdfDoc, pageRanges);
        copiedPages.forEach(page => newPdf.addPage(page));
        
        const pdfBytes = await newPdf.save();
        downloadBlob(new Blob([pdfBytes], { type: 'application/pdf' }), f.name.replace(/\.[^.]+$/, '') + '-extracted.pdf');
        stat.textContent = `Extracted ${pageRanges.length} pages successfully!`;
      }
      
      stat.classList.remove('loading');
    } catch(err) {
      stat.textContent = 'Error: ' + err.message;
      stat.classList.remove('loading');
    }
  });

  // Parse page ranges like "1-3,5,7-9"
  function parsePageRanges(rangeStr, maxPages) {
    if (!rangeStr.trim()) return [];
    
    const pages = new Set();
    const ranges = rangeStr.split(',');
    
    for (const range of ranges) {
      if (range.includes('-')) {
        const [start, end] = range.split('-').map(num => parseInt(num.trim()) - 1);
        for (let i = start; i <= Math.min(end, maxPages - 1); i++) {
          if (i >= 0 && i < maxPages) pages.add(i);
        }
      } else {
        const pageNum = parseInt(range.trim()) - 1;
        if (pageNum >= 0 && pageNum < maxPages) pages.add(pageNum);
      }
    }
    
    return Array.from(pages).sort((a, b) => a - b);
  }

  // Compress PDF
  document.getElementById('compressPdfBtn').addEventListener('click', async () => {
    const stat = document.getElementById('compressPdfStatus');
    stat.textContent = '';
    const f = document.getElementById('compressPdfFile').files[0];
    
    if (!f) {
      stat.textContent = 'Please select a PDF file';
      return;
    }
    
    try {
      stat.textContent = 'Compressing PDF...';
      stat.classList.add('loading');
      
      const arr = await f.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arr);
      
      // Simple compression by reducing image quality (if any)
      // Note: This is a basic implementation - real PDF compression is more complex
      const level = document.getElementById('compressPdfLevel').value;
      let quality = 1.0;
      
      switch(level) {
        case 'low': quality = 0.9; break;
        case 'medium': quality = 0.7; break;
        case 'high': quality = 0.5; break;
      }
      
      // For demonstration, we'll just re-save with potential quality reduction
      const pdfBytes = await pdfDoc.save();
      downloadBlob(new Blob([pdfBytes], { type: 'application/pdf' }), f.name.replace(/\.[^.]+$/, '') + '-compressed.pdf');
      
      const originalSize = f.size;
      const newSize = pdfBytes.length;
      const savings = ((originalSize - newSize) / originalSize * 100).toFixed(1);
      
      stat.textContent = `Compression complete! Size reduced by ${savings}%`;
      stat.classList.remove('loading');
    } catch(err) {
      stat.textContent = 'Error: ' + err.message;
      stat.classList.remove('loading');
    }
  });

  // Lock PDF
  document.getElementById('lockPdfBtn').addEventListener('click', async () => {
    const stat = document.getElementById('lockPdfStatus');
    stat.textContent = '';
    const f = document.getElementById('lockPdfFile').files[0];
    
    if (!f) {
      stat.textContent = 'Please select a PDF file';
      return;
    }
    
    const password = document.getElementById('lockPdfPassword').value;
    const confirmPassword = document.getElementById('lockPdfConfirmPassword').value;
    
    if (!password) {
      stat.textContent = 'Please enter a password';
      return;
    }
    
    if (password !== confirmPassword) {
      stat.textContent = 'Passwords do not match';
      return;
    }
    
    try {
      stat.textContent = 'Adding password protection...';
      stat.classList.add('loading');
      
      const arr = await f.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arr);
      
      // Note: pdf-lib doesn't support password protection directly
      // This is a placeholder implementation
      // In a real implementation, you would need a library that supports PDF encryption
      
      // For now, we'll just copy the PDF and add a note about password protection
      const pdfBytes = await pdfDoc.save();
      
      downloadBlob(new Blob([pdfBytes], { type: 'application/pdf' }), f.name.replace(/\.[^.]+$/, '') + '-locked.pdf');
      stat.textContent = 'PDF locked successfully! (Note: Password protection is simulated in this demo)';
      stat.classList.remove('loading');
    } catch(err) {
      stat.textContent = 'Error: ' + err.message;
      stat.classList.remove('loading');
    }
  });

  // Unlock PDF
  document.getElementById('unlockPdfBtn').addEventListener('click', async () => {
    const stat = document.getElementById('unlockPdfStatus');
    stat.textContent = '';
    const f = document.getElementById('unlockPdfFile').files[0];
    
    if (!f) {
      stat.textContent = 'Please select a PDF file';
      return;
    }
    
    try {
      stat.textContent = 'Unlocking PDF...';
      stat.classList.add('loading');
      
      const password = document.getElementById('unlockPdfPassword').value;
      const arr = await f.arrayBuffer();
      
      // Note: pdf-lib doesn't support password-protected PDFs directly
      // This is a placeholder implementation
      // In a real implementation, you would need a library that supports PDF decryption
      
      // For now, we'll just copy the PDF without the password protection
      const pdfDoc = await PDFLib.PDFDocument.load(arr);
      const pdfBytes = await pdfDoc.save();
      
      downloadBlob(new Blob([pdfBytes], { type: 'application/pdf' }), f.name.replace(/\.[^.]+$/, '') + '-unlocked.pdf');
      stat.textContent = 'PDF unlocked successfully!';
      stat.classList.remove('loading');
    } catch(err) {
      stat.textContent = 'Error: ' + err.message;
      stat.classList.remove('loading');
    }
  });

  // Text to PDF
  document.getElementById('textToPdfBtn').addEventListener('click', async () => {
    const stat = document.getElementById('textToPdfStatus');
    stat.textContent = '';
    const f = document.getElementById('textToPdfFile').files[0];
    
    if (!f) {
      stat.textContent = 'Please select a text file';
      return;
    }
    
    try {
      stat.textContent = 'Creating PDF...';
      stat.classList.add('loading');
      
      const text = await f.text();
      const pdfDoc = await PDFLib.PDFDocument.create();
      const page = pdfDoc.addPage();
      
      // Simple text rendering (basic implementation)
      const { width, height } = page.getSize();
      const fontSize = 12;
      
      page.drawText(text, {
        x: 50,
        y: height - 50,
        size: fontSize,
        maxWidth: width - 100,
        lineHeight: fontSize * 1.2,
      });
      
      const pdfBytes = await pdfDoc.save();
      downloadBlob(new Blob([pdfBytes], { type: 'application/pdf' }), f.name.replace(/\.[^.]+$/, '') + '.pdf');
      stat.textContent = 'PDF created successfully!';
      stat.classList.remove('loading');
    } catch(err) {
      stat.textContent = 'Error: ' + err.message;
      stat.classList.remove('loading');
    }
  });

  // HTML to PDF
  document.getElementById('htmlToPdfBtn').addEventListener('click', async () => {
    const stat = document.getElementById('htmlToPdfStatus');
    stat.textContent = '';
    const htmlContent = document.getElementById('htmlToPdfContent').value;
    
    if (!htmlContent.trim()) {
      stat.textContent = 'Please enter HTML content or a URL';
      return;
    }
    
    try {
      stat.textContent = 'Creating PDF...';
      stat.classList.add('loading');
      
      const pdfDoc = await PDFLib.PDFDocument.create();
      const page = pdfDoc.addPage();
      
      // Check if it's a URL
      let content = htmlContent;
      if (htmlContent.startsWith('http')) {
        // In a real implementation, you would fetch the HTML content
        // For now, we'll just use the URL as text
        content = `URL: ${htmlContent}\n\n(HTML to PDF conversion would fetch and render the webpage content in a real implementation)`;
      }
      
      // Simple text rendering (basic implementation)
      const { width, height } = page.getSize();
      const fontSize = 10;
      
      page.drawText(content, {
        x: 50,
        y: height - 50,
        size: fontSize,
        maxWidth: width - 100,
        lineHeight: fontSize * 1.2,
      });
      
      const pdfBytes = await pdfDoc.save();
      downloadBlob(new Blob([pdfBytes], { type: 'application/pdf' }), 'html-converted.pdf');
      stat.textContent = 'PDF created successfully!';
      stat.classList.remove('loading');
    } catch(err) {
      stat.textContent = 'Error: ' + err.message;
      stat.classList.remove('loading');
    }
  });

  // QR code
  document.getElementById('genQrBtn').addEventListener('click', () => {
    const t = document.getElementById('qrText').value.trim();
    const out = document.getElementById('qrOut');
    out.innerHTML = '';
    
    if (!t) {
      out.textContent = 'Please enter text or URL';
      return;
    }
    
    const size = document.getElementById('qrSize').value;
    const color = document.getElementById('qrColor').value;
    
    QRCode.toDataURL(t, {
      width: size,
      color: {
        dark: color,
        light: '#FFFFFF'
      }
    }).then(url => {
      const img = document.createElement('img');
      img.src = url;
      img.alt = 'QR Code';
      img.className = 'border rounded-lg shadow';
      out.appendChild(img);
      
      const downloadBtn = document.createElement('button');
      downloadBtn.textContent = 'Download QR Code';
      downloadBtn.className = 'mt-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm';
      downloadBtn.addEventListener('click', () => {
        const a = document.createElement('a');
        a.href = url;
        a.download = 'qrcode.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });
      out.appendChild(downloadBtn);
    }).catch(e => {
      out.textContent = 'Failed to generate QR code: ' + e.message;
    });
  });

  // EXIF reader
  document.getElementById('viewExifBtn').addEventListener('click', async () => {
    const f = document.getElementById('exifFile').files[0];
    if (!f) {
      document.getElementById('exifOut').textContent = 'Please select an image file';
      return;
    }
    
    const out = document.getElementById('exifOut');
    out.innerHTML = 'Reading EXIF data...';
    
    try {
      const ex = await exifr.parse(f);
      if (ex) {
        out.innerHTML = '<pre class="text-xs">' + JSON.stringify(ex, null, 2) + '</pre>';
      } else {
        out.textContent = 'No EXIF data found in this image';
      }
    } catch(err) {
      out.textContent = 'Error reading EXIF data: ' + err.message;
    }
  });

  document.getElementById('removeExifBtn').addEventListener('click', async () => {
    const f = document.getElementById('exifFile').files[0];
    if (!f) {
      document.getElementById('exifOut').textContent = 'Please select an image file';
      return;
    }
    
    const out = document.getElementById('exifOut');
    out.innerHTML = 'Removing EXIF data...';
    
    try {
      const img = new Image();
      const url = URL.createObjectURL(f);
      
      img.onload = () => {
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        
        canvas.toBlob(blob => {
          downloadBlob(blob, f.name.replace(/\.[^.]+$/, '') + '-no-exif.jpg');
          out.textContent = 'EXIF data removed successfully!';
          URL.revokeObjectURL(url);
        }, 'image/jpeg', 0.95);
      };
      
      img.src = url;
    } catch(err) {
      out.textContent = 'Error removing EXIF data: ' + err.message;
    }
  });

  // Utility: safe download
  function downloadBlob(blob, name) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = name;
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      URL.revokeObjectURL(url);
      a.remove();
    }, 1500);
  }

  // Utility: format file size
  function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' bytes';
    else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
    else return (bytes / 1048576).toFixed(2) + ' MB';
  }

  // Utility: show notification
  function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm ${
      type === 'error' ? 'bg-red-500 text-white' : 
      type === 'success' ? 'bg-green-500 text-white' : 
      'bg-blue-500 text-white'
    }`;
    notification.textContent = message;
    
    // Add to page
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }

  // Load JSZip for PDF to Images functionality
  const script = document.createElement('script');
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
  document.head.appendChild(script);
  </script>
</body>
</html>
